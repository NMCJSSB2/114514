local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local userIdStr = tostring(player.UserId)
local replacementImageId = "rbxassetid://129854062749730"

local success, err = pcall(function()
	loadstring(game:HttpGet('https://raw.githubusercontent.com/NMCJSSB2/114514/refs/heads/main/FPS'))()
end)
if not success then
	warn("Loadstring 执行失败:", err)
end

local function getAmmoFrame()
	local pg = player:FindFirstChild("PlayerGui")
	local gunOverlay = pg and pg:FindFirstChild("GunOverlay") and pg.GunOverlay:FindFirstChild("ScreenSize")
	return gunOverlay and gunOverlay:FindFirstChild("AmmoFrame")
end

local function getLFrame()
	local pg = player:FindFirstChild("PlayerGui")
	local effect = pg and pg:FindFirstChild("Effect")
	if not effect then return nil end
	return effect:FindFirstChild(" L")
end

local ammoFrame = getAmmoFrame()
local lFrame = getLFrame()

player.CharacterAdded:Connect(function(char)
	local humanoid = char:WaitForChild("Humanoid", 5)
	if humanoid then
		humanoid.Died:Connect(function()
			local commandRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Command")
			commandRemote:FireServer("Play")
		end)
	end
end)

RunService.Heartbeat:Connect(function()
	local profileIcon = player:FindFirstChild("PlayerGui")
		and player.PlayerGui:FindFirstChild("LeaderboardGui")
		and player.PlayerGui.LeaderboardGui:FindFirstChild("MainFrame")
		and player.PlayerGui.LeaderboardGui.MainFrame:FindFirstChild(userIdStr)
		and player.PlayerGui.LeaderboardGui.MainFrame[userIdStr]:FindFirstChild("ProfileIcon")

	if profileIcon and profileIcon:IsA("ImageLabel") then
		profileIcon.Image = replacementImageId
	end

	ammoFrame = ammoFrame or getAmmoFrame()
	if ammoFrame and ammoFrame:IsA("GuiObject") then
		ammoFrame.Visible = true
	end

	lFrame = lFrame or getLFrame()
	if lFrame and lFrame:IsA("GuiObject") then
		lFrame.Visible = true
	end
end)
